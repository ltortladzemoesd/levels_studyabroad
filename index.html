<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Levels Academy – Europe Interactive Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>
<style>
  html,body{margin:0;height:100%;font-family:ui-sans-serif,system-ui,Arial}
  .app{display:grid;grid-template-columns:1.4fr .8fr;height:100%}
  #map{height:100%;width:100%}
  .panel{border-left:1px solid #ddd;display:flex;flex-direction:column}
  .panel-head{padding:12px 16px;background:#2B445B;color:#fff;display:flex;justify-content:space-between;align-items:center}
  .list{flex:1;overflow:auto;padding:12px}
  .uni{padding:10px 12px;border:1px solid #eef2f5;border-radius:14px;margin:8px 0}
  .rank{font-weight:700;padding:2px 8px;border-radius:8px;display:inline-block;margin-bottom:4px}
  .rank.t1{background:#23B899;color:#fff}
  .rank.t2{background:#FDE200;color:#222}
  .rank.t3{background:#F66E6E;color:#fff}
  .uni-name{font-weight:700}
  .muted{color:#666;font-size:13px}
</style>
</head>
<body>
<div class="app">
  <div id="map"></div>
  <aside class="panel">
    <div class="panel-head">
      <div id="panelTitle">Pick a country</div>
      <div id="countBadge">0</div>
    </div>
    <div class="list" id="uniList"></div>
  </aside>
</div>

<script>
// === Demo QS data (replace with Excel extract) ===
const data = [
  {country:'United Kingdom', euRank:2,  name:'Imperial College London'},
  {country:'United Kingdom', euRank:3,  name:'University of Oxford'},
  {country:'United Kingdom', euRank:4,  name:'University of Cambridge'},
  {country:'United Kingdom', euRank:5,  name:'UCL'},
  {country:'Switzerland', euRank:1,  name:'ETH Zurich'},
  {country:'Switzerland', euRank:10, name:'EPFL'},
  {country:'Germany', euRank:11, name:'Technical University of Munich'},
  {country:'Germany', euRank:18, name:'LMU Munich'},
  {country:'France', euRank:9, name:'Université PSL'},
  {country:'Netherlands', euRank:15, name:'Delft University of Technology'},
  {country:'Netherlands', euRank:17, name:'University of Amsterdam'},
  {country:'Sweden', euRank:13, name:'Lund University'},
];

// group by country
function universitiesByCountry(c){
  return data.filter(d=>d.country===c).sort((a,b)=>a.euRank-b.euRank);
}
function tier(r){return r<=50?'t1':(r<=200?'t2':'t3');}

// === Map setup ===
const map = L.map('map').setView([54,15],4);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

// === Load Europe borders ===
fetch("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")
  .then(r=>r.json())
  .then(topology=>{
    const geo = topojson.feature(topology, topology.objects.countries);
    // Only Europe countries (simplified by lon/lat bounding box)
    const europe = geo.features.filter(f=>{
      const [lon,lat] = f.properties.centroid || [0,0];
      return lat>35 && lat<71 && lon>-25 && lon<45;
    });
    L.geoJSON(europe,{
      style: f=>{
        const cName=f.properties.name;
        const has=universitiesByCountry(cName).length>0;
        return {color:"#888",weight:1,fillColor:has?"#e5f7f1":"#f5f5f5",fillOpacity:1};
      },
      onEachFeature:(feature,layer)=>{
        const name=feature.properties.name;
        layer.bindTooltip(name,{permanent:true,direction:"center",className:"country-label"});
        layer.on("click",()=>showCountry(name));
        layer.on("mouseover",()=>layer.setStyle({fillColor:"#23B899"}));
        layer.on("mouseout",()=>layer.setStyle({
          fillColor:universitiesByCountry(name).length>0?"#e5f7f1":"#f5f5f5"
        }));
      }
    }).addTo(map);
  });

// === Panel logic ===
const titleEl=document.getElementById('panelTitle');
const countEl=document.getElementById('countBadge');
const listEl=document.getElementById('uniList');
function showCountry(name){
  const list=universitiesByCountry(name);
  titleEl.textContent=name;
  countEl.textContent=`${list.length}`;
  listEl.innerHTML=list.map(u=>`
    <div class="uni">
      <div class="rank ${tier(u.euRank)}">#${u.euRank}</div>
      <div class="uni-name">${u.name}</div>
      <div class="muted">Rank in Europe</div>
    </div>
  `).join('') || `<div class="muted">No universities listed</div>`;
}
</script>
</body>
</html>
